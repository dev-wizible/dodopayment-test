# 🚀 SaaS Subscription Management with DodoPayments

A professional subscription management system built with Node.js, Express, and DodoPayments integration.

## 🌟 Features

- ✅ **Professional Subscription Flow**: Create, cancel, and manage subscriptions
- ✅ **Grace Period Handling**: Users keep premium access until billing period ends
- ✅ **Automated Expiration**: Background job handles expired subscriptions
- ✅ **Real-time UI Updates**: Status banners with countdown timers
- ✅ **Webhook Integration**: Syncs with DodoPayments events
- ✅ **Production Ready**: Deployed on Render with proper error handling

## 🚀 Quick Start

### Local Development

1. **Clone and Install**

   ```bash
   git clone <your-repo>
   cd dodopayment
   npm install
   ```

2. **Environment Setup**

   ```bash
   cp .env.example .env
   # Fill in your actual credentials in .env
   ```

3. **Start Development Server**
   ```bash
   npm run dev
   ```

### Production Deployment (Render)

1. **Connect Repository** to Render
2. **Set Environment Variables** in Render dashboard:

   - `SUPABASE_URL`
   - `SUPABASE_ANON_KEY`
   - `DODO_API_KEY`
   - `DODO_SUBSCRIPTION_PRODUCT_ID`
   - `FRONTEND_URL` (auto-generated by Render)

3. **Deploy** - Render will automatically build and deploy

## 🔧 Environment Variables

| Variable                       | Description                  | Example                                 |
| ------------------------------ | ---------------------------- | --------------------------------------- |
| `SUPABASE_URL`                 | Your Supabase project URL    | `https://xxx.supabase.co`               |
| `SUPABASE_ANON_KEY`            | Supabase anonymous key       | `eyJhbGciOiJIUzI1NiI...`                |
| `DODO_API_KEY`                 | DodoPayments API key         | `sk_test_...` or `sk_live_...`          |
| `DODO_BASE_URL`                | DodoPayments API base URL    | `https://api.dodopayments.com`          |
| `DODO_SUBSCRIPTION_PRODUCT_ID` | Your subscription product ID | `prod_...`                              |
| `FRONTEND_URL`                 | Your deployed app URL        | `https://dodopayment-test.onrender.com` |

## 📋 API Endpoints

- `GET /` - Main application interface
- `POST /api/create-subscription` - Create new subscription
- `POST /api/cancel-subscription` - Cancel subscription (with grace period)
- `GET /api/user/:userId/status` - Get user subscription status
- `POST /api/webhooks/dodopayments` - Handle DodoPayments webhooks
- `GET /success` - Payment success redirect handler

## 🎯 Subscription Flow

```
User Clicks Cancel → Subscription marked as "cancelling"
                  → User keeps premium access
                  → UI shows countdown: "Premium ends in X days"
                  → Billing date passes
                  → Automated job runs
                  → User becomes "free"
                  → UI updates to show expired status
```

## 🔒 Security Features

- Input validation and sanitization
- Subscription ownership verification
- Error handling and logging
- Environment variable protection

## 📊 Monitoring

The application includes comprehensive logging:

- Subscription lifecycle events
- Webhook processing
- Error tracking with context
- Automated job execution logs

## 🛠️ Tech Stack

- **Backend**: Node.js, Express
- **Database**: Supabase (PostgreSQL)
- **Payments**: DodoPayments
- **Frontend**: Vanilla JavaScript, HTML, CSS
- **Deployment**: Render

## 📞 Support

For issues or questions:

1. Check the logs in Render dashboard
2. Verify environment variables are set correctly
3. Ensure webhook URL is configured in DodoPayments
4. Review the `SUBSCRIPTION_GUIDE.md` for detailed implementation notes

---

Built with ❤️ for professional SaaS applications
