# ğŸš€ SaaS Subscription Management with DodoPayments

A professional subscription management system built with Node.js, Express, and DodoPayments integration.

## ğŸŒŸ Features

- âœ… **Professional Subscription Flow**: Create, cancel, and manage subscriptions
- âœ… **Grace Period Handling**: Users keep premium access until billing period ends
- âœ… **Automated Expiration**: Background job handles expired subscriptions
- âœ… **Real-time UI Updates**: Status banners with countdown timers
- âœ… **Webhook Integration**: Syncs with DodoPayments events
- âœ… **Production Ready**: Deployed on Render with proper error handling

## ğŸš€ Quick Start

### Local Development

1. **Clone and Install**

   ```bash
   git clone <your-repo>
   cd dodopayment
   npm install
   ```

2. **Environment Setup**

   ```bash
   cp .env.example .env
   # Fill in your actual credentials in .env
   ```

3. **Start Development Server**
   ```bash
   npm run dev
   ```

### Production Deployment (Render)

1. **Connect Repository** to Render
2. **Set Environment Variables** in Render dashboard:

   - `SUPABASE_URL`
   - `SUPABASE_ANON_KEY`
   - `DODO_API_KEY`
   - `DODO_SUBSCRIPTION_PRODUCT_ID`
   - `FRONTEND_URL` (auto-generated by Render)

3. **Deploy** - Render will automatically build and deploy

## ğŸ”§ Environment Variables

| Variable                       | Description                  | Example                                 |
| ------------------------------ | ---------------------------- | --------------------------------------- |
| `SUPABASE_URL`                 | Your Supabase project URL    | `https://xxx.supabase.co`               |
| `SUPABASE_ANON_KEY`            | Supabase anonymous key       | `eyJhbGciOiJIUzI1NiI...`                |
| `DODO_API_KEY`                 | DodoPayments API key         | `sk_test_...` or `sk_live_...`          |
| `DODO_BASE_URL`                | DodoPayments API base URL    | `https://api.dodopayments.com`          |
| `DODO_SUBSCRIPTION_PRODUCT_ID` | Your subscription product ID | `prod_...`                              |
| `FRONTEND_URL`                 | Your deployed app URL        | `https://dodopayment-test.onrender.com` |

## ğŸ“‹ API Endpoints

- `GET /` - Main application interface
- `POST /api/create-subscription` - Create new subscription
- `POST /api/cancel-subscription` - Cancel subscription (with grace period)
- `GET /api/user/:userId/status` - Get user subscription status
- `POST /api/webhooks/dodopayments` - Handle DodoPayments webhooks
- `GET /success` - Payment success redirect handler

## ğŸ¯ Subscription Flow

```
User Clicks Cancel â†’ Subscription marked as "cancelling"
                  â†’ User keeps premium access
                  â†’ UI shows countdown: "Premium ends in X days"
                  â†’ Billing date passes
                  â†’ Automated job runs
                  â†’ User becomes "free"
                  â†’ UI updates to show expired status
```

## ğŸ”’ Security Features

- Input validation and sanitization
- Subscription ownership verification
- Error handling and logging
- Environment variable protection

## ğŸ“Š Monitoring

The application includes comprehensive logging:

- Subscription lifecycle events
- Webhook processing
- Error tracking with context
- Automated job execution logs

## ğŸ› ï¸ Tech Stack

- **Backend**: Node.js, Express
- **Database**: Supabase (PostgreSQL)
- **Payments**: DodoPayments
- **Frontend**: Vanilla JavaScript, HTML, CSS
- **Deployment**: Render

## ğŸ“ Support

For issues or questions:

1. Check the logs in Render dashboard
2. Verify environment variables are set correctly
3. Ensure webhook URL is configured in DodoPayments
4. Review the `SUBSCRIPTION_GUIDE.md` for detailed implementation notes

---

Built with â¤ï¸ for professional SaaS applications
